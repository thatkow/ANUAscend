<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ascend – Progression</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: #040805;
        background-image: radial-gradient(circle at top right, rgba(39, 180, 219, 0.18), transparent 45%),
          radial-gradient(circle at bottom left, rgba(126, 217, 87, 0.2), transparent 40%);
        color: #f5f7fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .hidden {
        display: none !important;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.25rem clamp(1.5rem, 4vw, 3rem);
        background: rgba(6, 10, 8, 0.82);
        backdrop-filter: blur(14px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }

      .brand {
        font-weight: 700;
        font-size: 1.1rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(245, 247, 250, 0.85);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .header-button {
        border-radius: 999px;
        border: 1px solid rgba(245, 247, 250, 0.24);
        background: rgba(12, 18, 15, 0.75);
        color: #f5f7fa;
        padding: 0.55rem 1.15rem;
        font-size: 0.9rem;
        font-weight: 600;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease,
          background 0.2s ease;
      }

      .header-button:hover,
      .header-button:focus-visible {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
        border-color: rgba(39, 180, 219, 0.65);
        outline: none;
      }

      main {
        flex: 1;
        padding: clamp(2rem, 6vw, 4rem) clamp(1.5rem, 6vw, 5rem) 4.5rem;
        display: flex;
        flex-direction: column;
        gap: clamp(2rem, 6vw, 3.5rem);
      }

      .progression-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: clamp(1.5rem, 4vw, 2.5rem);
      }

      .progression-summary-card {
        background: rgba(8, 12, 9, 0.78);
        border-radius: 1.2rem;
        padding: 1.75rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 18px 38px rgba(0, 0, 0, 0.35);
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      .progression-summary-card h2 {
        font-size: 1.2rem;
        font-weight: 700;
        letter-spacing: 0.02em;
      }

      .summary-metrics {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 1rem;
      }

      .summary-metric {
        background: rgba(255, 255, 255, 0.04);
        border-radius: 0.9rem;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .summary-label {
        font-size: 0.78rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(245, 247, 250, 0.65);
      }

      .summary-value {
        font-size: 1.4rem;
        font-weight: 700;
        color: #27b4db;
      }

      .summary-description {
        font-size: 0.92rem;
        color: rgba(245, 247, 250, 0.75);
        line-height: 1.6;
      }

      .progression-feed {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .progression-feed h2 {
        font-size: 1.1rem;
        font-weight: 700;
        letter-spacing: 0.01em;
      }

      .feed-card {
        background: rgba(8, 12, 9, 0.78);
        border-radius: 1rem;
        padding: 1.4rem;
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }

      .feed-card strong {
        font-weight: 700;
        color: rgba(245, 247, 250, 0.92);
      }

      .feed-card span {
        color: rgba(245, 247, 250, 0.7);
        font-size: 0.88rem;
      }

      .tutorial-prompt {
        position: fixed;
        right: clamp(1.25rem, 4vw, 2.5rem);
        bottom: clamp(1.5rem, 4vw, 3rem);
        border-radius: 999px;
        border: none;
        padding: 0.85rem 1.4rem;
        background: linear-gradient(135deg, rgba(126, 217, 87, 0.95), rgba(39, 180, 219, 0.95));
        color: #041005;
        font-weight: 700;
        letter-spacing: 0.02em;
        font-size: 0.98rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.55rem;
        box-shadow: 0 16px 38px rgba(0, 0, 0, 0.45);
        z-index: 30;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .tutorial-prompt:hover,
      .tutorial-prompt:focus-visible {
        transform: translateY(-4px);
        box-shadow: 0 22px 48px rgba(0, 0, 0, 0.55);
        outline: none;
      }

      .tutorial-overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        background: rgba(6, 10, 8, 0.74);
        backdrop-filter: blur(4px);
        z-index: 40;
      }

      .tutorial-overlay.is-bottom-aligned {
        align-items: flex-end;
      }

      .tutorial-overlay.is-bottom-aligned .tutorial-card {
        margin-bottom: clamp(1.5rem, 10vh, 4rem);
      }

      .tutorial-overlay.active {
        display: flex;
      }

      .tutorial-card {
        width: min(520px, 100%);
        background: rgba(12, 18, 15, 0.95);
        border-radius: 1.1rem;
        padding: 1.75rem;
        display: flex;
        flex-direction: column;
        gap: 1.15rem;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(39, 180, 219, 0.24);
      }

      .tutorial-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .tutorial-progress {
        font-size: 0.82rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(126, 217, 87, 0.85);
      }

      .tutorial-close {
        background: transparent;
        border: none;
        color: rgba(245, 247, 250, 0.65);
        font-size: 1.35rem;
        cursor: pointer;
        padding: 0.25rem;
        line-height: 1;
        transition: color 0.2s ease, transform 0.2s ease;
      }

      .tutorial-close:hover,
      .tutorial-close:focus-visible {
        color: rgba(245, 247, 250, 0.95);
        transform: scale(1.05);
        outline: none;
      }

      .tutorial-title {
        font-size: 1.35rem;
        font-weight: 700;
        line-height: 1.3;
      }

      .tutorial-description {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        font-size: 0.98rem;
        line-height: 1.55;
        color: rgba(248, 250, 252, 0.92);
      }

      .tutorial-description p {
        margin: 0;
      }

      .tutorial-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        justify-content: flex-end;
      }

      .tutorial-button {
        border-radius: 999px;
        border: none;
        padding: 0.65rem 1.4rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease,
          color 0.2s ease, border-color 0.2s ease;
      }

      .tutorial-primary {
        background: #7ed957;
        color: #041005;
        box-shadow: 0 12px 22px rgba(126, 217, 87, 0.3);
      }

      .tutorial-primary:hover,
      .tutorial-primary:focus-visible {
        transform: translateY(-1px);
        box-shadow: 0 18px 30px rgba(126, 217, 87, 0.35);
        outline: none;
      }

      .tutorial-secondary {
        background: transparent;
        color: rgba(248, 250, 252, 0.9);
        border: 1px solid rgba(248, 250, 252, 0.3);
      }

      .tutorial-secondary:hover,
      .tutorial-secondary:focus-visible {
        transform: translateY(-1px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
        outline: none;
        border-color: rgba(248, 250, 252, 0.6);
      }

      .tutorial-highlight {
        box-shadow: 0 0 0 5px rgba(39, 180, 219, 0.75), 0 0 26px rgba(39, 180, 219, 0.6);
      }

      .tutorial-illuminated {
        animation: tutorial-illuminate 1.2s ease-in-out infinite;
        box-shadow: 0 0 0 7px rgba(39, 180, 219, 0.85), 0 0 36px rgba(39, 180, 219, 0.7);
      }

      .tutorial-pointer {
        position: fixed;
        width: 102px;
        height: 162px;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        z-index: 60;
        transform: translate(-50%, -100%);
      }

      .tutorial-pointer.hidden {
        display: none;
      }

      .tutorial-pointer svg {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.45));
        animation: tutorial-pointer-bounce 1.05s ease-in-out infinite;
      }

      @media (max-width: 768px) {
        .tutorial-pointer {
          width: 51px;
          height: 81px;
        }
      }

      @keyframes tutorial-pointer-bounce {
        0%,
        100% {
          transform: translateY(4px);
        }
        50% {
          transform: translateY(-6px);
        }
      }

      @keyframes tutorial-illuminate {
        0%,
        100% {
          box-shadow: 0 0 0 6px rgba(39, 180, 219, 0.7), 0 0 28px rgba(39, 180, 219, 0.55);
        }
        50% {
          box-shadow: 0 0 0 10px rgba(126, 217, 87, 0.85), 0 0 42px rgba(126, 217, 87, 0.75);
        }
      }

      .info-callout-chart-wrapper {
        margin-top: 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .info-callout-chart {
        display: flex;
        align-items: flex-end;
        gap: 0.18rem;
        height: 52px;
        padding: 0 0.15rem;
      }

      .info-callout-chart-bar {
        flex: 1;
        min-width: 0.15rem;
        border-radius: 0.4rem 0.4rem 0 0;
        background: #2f9e44;
        height: 45%;
        opacity: 0.95;
      }

      .info-callout-chart-bar:first-child {
        border-top-left-radius: 0.45rem;
      }

      .info-callout-chart-bar:last-child {
        border-top-right-radius: 0.45rem;
      }

      .info-callout-chart-labels {
        display: flex;
        justify-content: space-between;
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.75);
        padding: 0 0.15rem;
        letter-spacing: 0.02em;
      }

      @media (max-width: 720px) {
        header {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .header-actions {
          align-self: stretch;
          justify-content: flex-start;
          flex-wrap: wrap;
        }

        .summary-metrics {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <header>
      <span class="brand">Ascend Progression</span>
      <div class="header-actions">
        <button id="progressionMenuButton" class="header-button" type="button" aria-haspopup="true" aria-expanded="false">
          Progression
        </button>
        <button id="setterToolsButton" class="header-button" type="button">
          Setter tools
        </button>
      </div>
    </header>

    <main>
      <section class="progression-summary" aria-label="Progression overview">
        <article class="progression-summary-card">
          <h2>Today&apos;s snapshot</h2>
          <div class="summary-metrics" role="list">
            <div class="summary-metric" role="listitem">
              <span class="summary-label">Ascended</span>
              <span class="summary-value">24</span>
            </div>
            <div class="summary-metric" role="listitem">
              <span class="summary-label">Focus</span>
              <span class="summary-value">3</span>
            </div>
            <div class="summary-metric" role="listitem">
              <span class="summary-label">Your grade</span>
              <span class="summary-value">V5</span>
            </div>
          </div>
          <p class="summary-description">
            Keep logging your sessions to refine the grade curve and see how your projects evolve across the gym.
          </p>
        </article>
        <article class="progression-summary-card">
          <h2>Weekly goal</h2>
          <p class="summary-description">
            Aim for three focused sessions. Tag your attempts so the Focus list keeps you accountable and surfaces fresh problems.
          </p>
        </article>
      </section>

      <section class="progression-feed" aria-label="Recent activity">
        <h2>Recent activity</h2>
        <article class="feed-card">
          <strong>Moonrise Traverse</strong>
          <span>Logged as Ascended · Yesterday</span>
        </article>
        <article class="feed-card">
          <strong>North Ridge Dyno</strong>
          <span>Marked as Focus · 2 days ago</span>
        </article>
        <article class="feed-card">
          <strong>Halcyon Arete</strong>
          <span>Added a note for the setters · 4 days ago</span>
        </article>
      </section>
    </main>

    <button
      id="tutorialPromptButton"
      class="tutorial-prompt"
      type="button"
      aria-haspopup="dialog"
      aria-controls="tutorialOverlay"
      aria-expanded="false"
    >
      <span aria-hidden="true">❓</span>
      Start tutorial
    </button>

    <div
      id="tutorialOverlay"
      class="tutorial-overlay"
      aria-hidden="true"
    >
      <div
        id="tutorialDialogCard"
        class="tutorial-card"
        role="dialog"
        aria-modal="true"
        aria-labelledby="tutorialTitle"
        aria-describedby="tutorialDescription"
        tabindex="-1"
      >
        <div class="tutorial-card-header">
          <div id="tutorialProgress" class="tutorial-progress"></div>
          <button id="tutorialCloseButton" class="tutorial-close" type="button" aria-label="Close tutorial">
            ×
          </button>
        </div>
        <h2 id="tutorialTitle" class="tutorial-title"></h2>
        <div id="tutorialDescription" class="tutorial-description"></div>
        <div class="tutorial-actions">
          <button
            id="tutorialSecondaryAction"
            class="tutorial-button tutorial-secondary hidden"
            type="button"
          >
            Back
          </button>
          <button
            id="tutorialPrimaryAction"
            class="tutorial-button tutorial-primary"
            type="button"
          >
            Next
          </button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const gradeScale = [
          { grade: 1, color: '#2F7E13' },
          { grade: 2, color: '#378B14' },
          { grade: 3, color: '#3E9015' },
          { grade: 4, color: '#459616' },
          { grade: 5, color: '#4BA218' },
          { grade: 6, color: '#50AE1A' },
          { grade: 7, color: '#59B51A' },
          { grade: 8, color: '#60BA19' },
          { grade: 9, color: '#68BF16' },
          { grade: 10, color: '#71C314' },
          { grade: 11, color: '#87C112' },
          { grade: 12, color: '#92C510' },
          { grade: 13, color: '#C6D208' },
          { grade: 14, color: '#DDD805' },
          { grade: 15, color: '#F3DF01' },
          { grade: 16, color: '#F6C20E' },
          { grade: 17, color: '#EEA21C' },
          { grade: 18, color: '#EA9621' },
          { grade: 19, color: '#E78A27' },
          { grade: 20, color: '#E37B27' },
          { grade: 21, color: '#E06A23' },
          { grade: 22, color: '#DC5A1E' },
          { grade: 23, color: '#D94A1B' },
          { grade: 24, color: '#D63F18' },
          { grade: 25, color: '#D33314' },
          { grade: 26, color: '#D02711' },
          { grade: 27, color: '#CE1A0D' },
          { grade: 28, color: '#C90E0B' },
          { grade: 29, color: '#C50809' },
          { grade: 30, color: '#C10407' },
          { grade: 31, color: '#BD0306' },
        ];

        const tutorialPromptButton = document.getElementById('tutorialPromptButton');
        const tutorialOverlay = document.getElementById('tutorialOverlay');
        const tutorialDialogCard = document.getElementById('tutorialDialogCard');
        const tutorialTitle = document.getElementById('tutorialTitle');
        const tutorialDescription = document.getElementById('tutorialDescription');
        const tutorialPrimaryAction = document.getElementById('tutorialPrimaryAction');
        const tutorialSecondaryAction = document.getElementById('tutorialSecondaryAction');
        const tutorialProgress = document.getElementById('tutorialProgress');
        const tutorialCloseButton = document.getElementById('tutorialCloseButton');
        const progressionMenuButton = document.getElementById('progressionMenuButton');
        const setterToolsButton = document.getElementById('setterToolsButton');
        const overviewCard = document.querySelector('.progression-summary-card');

        let tutorialSteps = [];
        let tutorialStepIndex = -1;
        let tutorialActive = false;
        let previousFocus = null;
        let highlightedElement = null;
        let tutorialPointer = null;
        let tutorialPointerTarget = null;

        function formatGradeDisplay(value) {
          if (typeof value !== 'number' || !Number.isFinite(value)) {
            return '—';
          }
          return Number.isInteger(value) ? String(value) : value.toFixed(1);
        }

        function createGradeChartElement() {
          const wrapper = document.createElement('div');
          wrapper.className = 'info-callout-chart-wrapper';
          wrapper.setAttribute('aria-hidden', 'true');

          const chart = document.createElement('div');
          chart.className = 'info-callout-chart';
          wrapper.appendChild(chart);

          const minimumHeight = 22;
          const maximumHeight = 100;
          const heightRange = maximumHeight - minimumHeight;
          const totalGrades = gradeScale.length;

          gradeScale.forEach((entry, index) => {
            const bar = document.createElement('span');
            bar.className = 'info-callout-chart-bar';
            const relative = totalGrades > 1 ? index / (totalGrades - 1) : 0;
            const heightPercent = minimumHeight + relative * heightRange;
            bar.style.height = `${heightPercent}%`;
            bar.style.backgroundColor = entry.color;
            bar.dataset.grade = String(entry.grade);
            chart.appendChild(bar);
          });

          if (gradeScale.length) {
            const labels = document.createElement('div');
            labels.className = 'info-callout-chart-labels';

            const middleIndex = Math.round((gradeScale.length - 1) / 2);

            const startLabel = document.createElement('span');
            startLabel.textContent = formatGradeDisplay(gradeScale[0].grade);

            const middleLabel = document.createElement('span');
            middleLabel.textContent = formatGradeDisplay(gradeScale[middleIndex].grade);

            const endLabel = document.createElement('span');
            endLabel.textContent = formatGradeDisplay(gradeScale[gradeScale.length - 1].grade);

            labels.appendChild(startLabel);
            labels.appendChild(middleLabel);
            labels.appendChild(endLabel);

            wrapper.appendChild(labels);
          }

          return wrapper;
        }

        function isElementVisible(element) {
          if (!element) {
            return false;
          }

          if (element.classList && element.classList.contains('hidden')) {
            return false;
          }

          const style = window.getComputedStyle(element);
          if (style.display === 'none' || style.visibility === 'hidden' || Number(style.opacity) === 0) {
            return false;
          }

          const rect = element.getBoundingClientRect();
          return rect.width > 0 && rect.height > 0;
        }

        function highlightElement(element, options = {}) {
          const { illuminate = false } = options;

          if (highlightedElement && highlightedElement !== element) {
            highlightedElement.classList.remove('tutorial-highlight', 'tutorial-illuminated');
          }

          if (!element || !isElementVisible(element)) {
            if (highlightedElement) {
              highlightedElement.classList.remove('tutorial-highlight', 'tutorial-illuminated');
            }
            highlightedElement = null;
            return;
          }

          highlightedElement = element;
          highlightedElement.classList.add('tutorial-highlight');
          highlightedElement.classList.toggle('tutorial-illuminated', Boolean(illuminate));
        }

        function getOrCreateTutorialPointer() {
          if (tutorialPointer) {
            return tutorialPointer;
          }

          tutorialPointer = document.createElement('div');
          tutorialPointer.className = 'tutorial-pointer hidden';
          tutorialPointer.setAttribute('aria-hidden', 'true');
          tutorialPointer.innerHTML =
            '<svg viewBox="0 0 64 96" role="presentation" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path fill="#27b4db" d="M32 0l32 36H44v56H20V36H0z"/></svg>';
          document.body.appendChild(tutorialPointer);
          return tutorialPointer;
        }

        function updateTutorialPointerPosition() {
          if (!tutorialPointer || tutorialPointer.classList.contains('hidden')) {
            return;
          }

          if (!tutorialPointerTarget || !isElementVisible(tutorialPointerTarget)) {
            hideTutorialPointer();
            return;
          }

          const rect = tutorialPointerTarget.getBoundingClientRect();
          tutorialPointer.style.left = `${rect.left + rect.width / 2}px`;
          tutorialPointer.style.top = `${rect.top}px`;
        }

        function showTutorialPointerFor(element) {
          if (!isElementVisible(element)) {
            hideTutorialPointer();
            return;
          }

          const pointer = getOrCreateTutorialPointer();
          tutorialPointerTarget = element;
          updateTutorialPointerPosition();
          pointer.classList.remove('hidden');
          pointer.setAttribute('aria-hidden', 'false');
        }

        function hideTutorialPointer() {
          tutorialPointerTarget = null;
          if (!tutorialPointer) {
            return;
          }
          tutorialPointer.classList.add('hidden');
          tutorialPointer.setAttribute('aria-hidden', 'true');
        }

        function setTutorialOverlayAlignment(alignment) {
          const shouldAlignBottom = alignment === 'bottom';
          tutorialOverlay.classList.toggle('is-bottom-aligned', shouldAlignBottom);
        }

        function renderDescription(step) {
          if (!tutorialDescription) {
            return;
          }

          tutorialDescription.innerHTML = '';

          (step.body || []).forEach((item) => {
            try {
              if (!item && item !== 0) {
                return;
              }

              if (typeof item === 'function') {
                const element = item();
                if (element instanceof HTMLElement) {
                  tutorialDescription.appendChild(element);
                }
                return;
              }

              if (item instanceof HTMLElement) {
                tutorialDescription.appendChild(item);
                return;
              }

              const paragraph = document.createElement('p');
              if (typeof item === 'string') {
                paragraph.textContent = item;
              } else {
                paragraph.textContent = String(item);
              }
              tutorialDescription.appendChild(paragraph);
            } catch (error) {
              console.warn('Unable to render tutorial body item:', error);
            }
          });
        }

        function buildTutorialSteps() {
          const steps = [
            {
              title: 'Welcome to your progression',
              body: [
                'This page keeps your climbing history, active projects, and trends together so you can track every session.',
              ],
              onEnter: () => {
                setTutorialOverlayAlignment('center');
                highlightElement(null);
                hideTutorialPointer();
              },
            },
            {
              title: 'Read the grade insights',
              body: [
                'The overview blends your Ascended climbs, Focus list, and current grade curve so you can see growth at a glance.',
                () => createGradeChartElement(),
                () => {
                  const paragraph = document.createElement('p');
                  paragraph.innerHTML =
                    '<strong>Ascended</strong> counts every climb you have completed, keeping your send streak visible.';
                  return paragraph;
                },
                () => {
                  const paragraph = document.createElement('p');
                  paragraph.innerHTML =
                    '<strong>Focus</strong> highlights projects you are actively working, helping you return to them quickly.';
                  return paragraph;
                },
                () => {
                  const paragraph = document.createElement('p');
                  paragraph.innerHTML =
                    '<strong>Your grade</strong> adapts as you log attempts and sends, reflecting the climbs that challenge you most.';
                  return paragraph;
                },
              ],
              onEnter: () => {
                setTutorialOverlayAlignment('center');
                if (overviewCard && isElementVisible(overviewCard)) {
                  highlightElement(overviewCard);
                } else {
                  highlightElement(null);
                }
                hideTutorialPointer();
              },
              onExit: () => {
                highlightElement(null);
              },
            },
            {
              title: 'Open the progression menu',
              body: [
                'Tap the Progression button whenever you want the complete list of your sends, in-progress projects, and upcoming goals.',
                'The menu filters climbs by status so you can focus on what matters during your next session.',
              ],
              onEnter: () => {
                setTutorialOverlayAlignment('bottom');
                if (progressionMenuButton && isElementVisible(progressionMenuButton)) {
                  highlightElement(progressionMenuButton, { illuminate: true });
                  showTutorialPointerFor(progressionMenuButton);
                } else {
                  highlightElement(null);
                  hideTutorialPointer();
                }
              },
              onExit: () => {
                setTutorialOverlayAlignment('center');
                highlightElement(null);
                hideTutorialPointer();
              },
            },
          ];

          if (setterToolsButton && isElementVisible(setterToolsButton)) {
            steps.push({
              title: 'Share feedback with the setters',
              body: [
                'Use the Setter tools button to jump into the workspace for notes, beta, and requests.',
                'Let the setting team know how projects feel or flag tweaks so future sessions stay fresh.',
              ],
              onEnter: () => {
                setTutorialOverlayAlignment('bottom');
                highlightElement(setterToolsButton, { illuminate: true });
                showTutorialPointerFor(setterToolsButton);
              },
              onExit: () => {
                setTutorialOverlayAlignment('center');
                highlightElement(null);
                hideTutorialPointer();
              },
            });
          }

          return steps;
        }

        function updateTutorialControls() {
          if (!tutorialPrimaryAction || !tutorialSecondaryAction || !tutorialProgress) {
            return;
          }

          const totalSteps = tutorialSteps.length;
          const currentStepNumber = tutorialStepIndex + 1;
          tutorialProgress.textContent = `Step ${currentStepNumber} of ${totalSteps}`;
          tutorialSecondaryAction.classList.toggle('hidden', tutorialStepIndex <= 0);
          tutorialPrimaryAction.textContent = tutorialStepIndex >= totalSteps - 1 ? 'Finish' : 'Next';
        }

        function goToTutorialStep(index) {
          if (!tutorialSteps.length) {
            return;
          }

          const clampedIndex = Math.min(Math.max(index, 0), tutorialSteps.length - 1);
          if (clampedIndex === tutorialStepIndex) {
            return;
          }

          if (tutorialStepIndex >= 0 && tutorialStepIndex < tutorialSteps.length) {
            const currentStep = tutorialSteps[tutorialStepIndex];
            if (currentStep && typeof currentStep.onExit === 'function') {
              currentStep.onExit();
            }
          }

          tutorialStepIndex = clampedIndex;
          const step = tutorialSteps[tutorialStepIndex];

          if (tutorialTitle) {
            tutorialTitle.textContent = step.title || '';
          }

          renderDescription(step);
          updateTutorialControls();

          if (step && typeof step.onEnter === 'function') {
            step.onEnter();
          }

          if (tutorialPrimaryAction) {
            tutorialPrimaryAction.focus();
          }
        }

        function stopTutorial({ restoreFocus = true } = {}) {
          if (!tutorialActive) {
            return;
          }

          if (tutorialStepIndex >= 0 && tutorialStepIndex < tutorialSteps.length) {
            const currentStep = tutorialSteps[tutorialStepIndex];
            if (currentStep && typeof currentStep.onExit === 'function') {
              currentStep.onExit();
            }
          }

          tutorialActive = false;
          tutorialStepIndex = -1;
          tutorialSteps = [];
          highlightElement(null);
          hideTutorialPointer();
          setTutorialOverlayAlignment('center');

          tutorialOverlay.classList.remove('active');
          tutorialOverlay.setAttribute('aria-hidden', 'true');
          tutorialPromptButton?.setAttribute('aria-expanded', 'false');

          if (restoreFocus && previousFocus && typeof previousFocus.focus === 'function') {
            previousFocus.focus();
          }
          previousFocus = null;
        }

        function startTutorial() {
          tutorialSteps = buildTutorialSteps();
          if (!tutorialSteps.length) {
            return;
          }

          previousFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;
          tutorialActive = true;
          tutorialStepIndex = -1;

          tutorialOverlay.classList.add('active');
          tutorialOverlay.setAttribute('aria-hidden', 'false');
          tutorialPromptButton?.setAttribute('aria-expanded', 'true');

          if (tutorialDialogCard) {
            tutorialDialogCard.focus();
          }

          goToTutorialStep(0);
        }

        if (tutorialPromptButton) {
          tutorialPromptButton.addEventListener('click', () => {
            if (tutorialActive) {
              return;
            }
            startTutorial();
          });
        }

        if (tutorialPrimaryAction) {
          tutorialPrimaryAction.addEventListener('click', () => {
            if (!tutorialActive) {
              return;
            }

            if (tutorialStepIndex >= tutorialSteps.length - 1) {
              stopTutorial();
              return;
            }

            goToTutorialStep(tutorialStepIndex + 1);
          });
        }

        if (tutorialSecondaryAction) {
          tutorialSecondaryAction.addEventListener('click', () => {
            if (!tutorialActive) {
              return;
            }
            goToTutorialStep(tutorialStepIndex - 1);
          });
        }

        if (tutorialCloseButton) {
          tutorialCloseButton.addEventListener('click', () => {
            stopTutorial();
          });
        }

        if (tutorialOverlay) {
          tutorialOverlay.addEventListener('click', (event) => {
            if (event.target === tutorialOverlay) {
              stopTutorial();
            }
          });
        }

        document.addEventListener('keydown', (event) => {
          if (!tutorialActive) {
            return;
          }

          if (event.key === 'Escape') {
            event.preventDefault();
            stopTutorial();
            return;
          }

          if (event.key === 'ArrowRight') {
            event.preventDefault();
            if (tutorialStepIndex < tutorialSteps.length - 1) {
              goToTutorialStep(tutorialStepIndex + 1);
            }
            return;
          }

          if (event.key === 'ArrowLeft') {
            event.preventDefault();
            if (tutorialStepIndex > 0) {
              goToTutorialStep(tutorialStepIndex - 1);
            }
          }
        });

        window.addEventListener('resize', updateTutorialPointerPosition);
        window.addEventListener('scroll', updateTutorialPointerPosition, true);
      })();
    </script>
  </body>
</html>
